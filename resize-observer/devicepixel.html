<!doctype html>
<link rel="match" href="devicepixel-ref.html">
<meta name="assert" content="Device pixel content box sizes and pixel snapping are correct in Resize Observer callback">
<!--
  This test verifies that the device pixel content box sizes available
  in a resize observer callback are correct. Resize observer notifications
  are delivered as the element is loaded. A box is then filled using the
  available dimensions in device pixels. The result is compared to the reference
  which uses SVG to draw a box.
-->
<body>
<style>
  html {
    height: 100%;
    overflow:hidden;
  }
  body {
    margin:0;
    height:100%;
  }
  #canvas2D {
    width: 100%;
    height: 100%;
  }
  #outer {
    padding-top: 1.7px;
    width: 300.8px;
    height: 250.1px;
  }

</style>
<div id="outer">
  <canvas id="canvas2D"></canvas>
</div>

<script>
(function() {
  let canvas2D = document.querySelector("#canvas2D");
  let ctx = canvas2D.getContext("2d");


  // Create a box using device pixel content box dimensions
  function paint2D(snappedSize) {
    ctx.fillStyle = '#f00';
    ctx.beginPath();
    ctx.moveTo(snappedSize.inlineSize,0);
    ctx.lineTo(0,0);
    ctx.lineTo(0,snappedSize.blockSize);
    ctx.lineTo(snappedSize.inlineSize,snappedSize.blockSize);
    ctx.closePath();
    ctx.fill();
  }
  function updateCanvasSize2D(snappedSize) {
    canvas2D.width = snappedSize.inlineSize || snappedSize.width;
    canvas2D.height = snappedSize.blockSize || snappedSize.height;
    paint2D(snappedSize);
  }
  window.updateCanvasSize2D = updateCanvasSize2D;
})();


(function() {
  let canvas2D = document.querySelector("#canvas2D");

  function observeSizes() {
    let ro = new ResizeObserver( entries => {
      for (entry of entries) {
        if (entry.target == canvas2D) {
          let size = entry.devicePixelContentBoxSize;
          updateCanvasSize2D(size);
        }
      }
    });
    ro.observe(canvas2D, {box: "device-pixel-content-box"});
  }
  observeSizes();
})();
</script>
